# Ch11 条件随机场

Conditional random field, CRF 是给定一组输入随机变量条件下，另一组输出随机变量的条件概率分布模型

特点：假设输出随机变量构成马尔科夫随机场。

条件随机场可以用于不同的预测问题，比如标准问题。。

对于线性链条件随机场，问题可以编程由输入序列对输出序列预测的判别模型，形式为对数线性模型。学习方法通常是极大似然估计或正则化的极大似然估计。

<!-- TOC -->

- [1. 概率无向图模型](#1-概率无向图模型)
    - [模型定义](#模型定义)

<!-- /TOC -->

## 1. 概率无向图模型

又称为马尔科夫随机场，是一个可以由无向图表示的联合概率分布。

### 模型定义

由图表示概率分布。节点 $v\in V$ 表示一个随机变量 $Y_v, Y=(Y_v)_{v\in V}$，边 $e\in E$ 表示随机变量之间的概率依赖关系。

给定一个联合概率分布 $P(Y)$ 和表示它的无向图（$G$）：

首先定义无向图表示的随机变量之间存在的成对马尔科夫性、局部马尔科夫性、全局马尔科夫性。

1. 成对马尔科夫性：
> 设 $v,u$ 是 $G$ 中任意两个没有边连接的点，对应随机变量 $Y_v,Y_u$，其他所有节点为 $O$，对应随机变量 $Y_o$。随机变量组 $Y_o$ 的条件下，随机变量 $Y_u$ 和 $Y_v$ 是条件独立的。

$$
P(Y_u,Y_v|Y_o) = P(Y_u|Y_o)P(Y_v|Y_o)
$$

2. 局部马尔科夫性：
> 设 $v$ 是任一节点，$W$ 是与 $v$ 有连接的所有节点集合，$O$ 是其余节点。在给定随机变量组 $Y_w$ 的条件下，$Y_o$ 与 $Y_v$ 条件独立。

$$
P(Y_v,Y_o|Y_w) = P(Y_v|Y_w) P(Y_o|Y_w)
$$

在 $P(Y_o|Y_w) > 0$，可以推出：

$$
P(Y_v|Y_w) = P(Y_v|Y_w,Y_o)
$$

3. 全局马尔科夫性：
> 设集合 $A,B$ 是在无向图 $G$ 中被 $C$ 分开的任意节点集合，$Y_c$ 条件下，$Y_a,Y_b$ 条件独立。

$$
P(Y_a,Y_b|Y_c) = P(Y_a|Y_c) P(Y_b|Y_c)
$$

**概率无向图模型：**
设有联合概率分布 $P(Y)$，由无向图$G$表示，节点表示随机变量，边表示随机变量之间的依赖关系。如果满足上述的马尔科夫性，就称此联合概率分布为概率无向图模型，或者马尔可夫随机场。

更关心如何求其概率联合分布，对给定的概率无向图模型，我们希望将整体的联合概率写成若干子联合概率的乘积形式，也就是将联合概率进行因子分解，这样便于模型的学习与计算。

概率无向图模型的最大特点就是易于因子分解。

### 概率无向图模型的因子分解

无向图中，任何两个节点均有边连接的节点子集合称为团（clique）。若 C 是无向图 G 的一个团，并且不能再加入任何一个 G 的节点使其成为一个更大的团，则称 C 为最大团。

将概率无向图模型的联合概率分布表示为其最大团上的随机变量的函数的乘积形式的操作，称为概率无向图模型的因子分解（factorization）。

$$
P(Y) = \frac 1 Z \prod_c \Psi_c(Y_c)
$$

$Z$ 是规范化因子

$$
Z = \sum_y \prod_c \Psi_c(Y_c)
$$

$\Psi_c(Y_c)$ 称为势函数，要求严格正的，通常定义为指数函数：

$$
\Psi_c(Y_c) = \exp(-E(Y_c))
$$

## 条件随机场的定义与形式

### 条件随机场的定义

CRF 是给定随机变量 $X$ 条件下，随机变量 $Y$ 的马尔可夫随机场。

线性链条件下的马尔科夫随机场可以用于标注等问题。

在条件概率模型 $P(Y|X)$ 中，$Y$ 是输出变量，表示标记序列，$X$ 是输入变量，表示要标注的观测序列。也把标记序列称为状态序列。

- 学习时，利用训练数据集通过极大似然估计或正则化的极大似然估计得到条件概率模型 $\hat P(Y|X)$；
- 预测时，对于给定的输入序列 $x$，求出条件概率 $\hat P(y|x)$ 最大的输出序列 $\hat y$


